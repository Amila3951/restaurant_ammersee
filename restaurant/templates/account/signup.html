{% extends 'base.html' %}

{% block content %}
<form method="post" action="{% url 'account_signup' %}" class="signup-form" onsubmit="sendEmail(this);"> 
  <h1>Sign Up</h1>
  {% csrf_token %}
  <div>
    {{ form.email.label_tag }}
    {{ form.email }}
  </div>
  <div>
    {{ form.username.label_tag }}
    {{ form.username }}
  </div> 

  <button type="submit">Sign Up</button>
  <p>Already have an account? <a href="{% url 'account_login' %}">Log in</a></p>
</form>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript">
  (function () {
    emailjs.init("JtEjZpi5gTulnaLfS");  // Initialize EmailJS with your public key
  })();

  // Function to send the email (this will be called from the view)
  function sendEmail(form) {
    const email = form.elements['email'].value;
    const username = form.elements['username'].value;

    const templateParams = {
      to_email: email,
      username: username
    };

    emailjs.send('service_ab2vrqc', 'template_oo7qvf5', templateParams)
      .then((result) => {
        console.log(result.text);
      }, (error) => {
        console.log(error.text);
      });
  }
</script>
<script src="{% static 'js/email.js' %}"></script> 
{% endblock %}