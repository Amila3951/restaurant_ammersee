{% extends 'base.html' %}

{% block content %}
  <form method="post" action="{% url 'account_signup' %}" class="signup-form" onsubmit="sendEmail(event)">  {# Call sendEmail function when the form is submitted #}
    <h1>Sign Up</h1> 
    {% csrf_token %} {# This is a Django template tag for security purposes. #}
    {{ form.as_p }}  {# Render the form fields as paragraphs #}

    <button type="submit">Sign Up</button> 
    <p>Already have an account? <a href="{% url 'account_login' %}">Log in</a></p> {# Django template tag to generate the login URL #}
  </form>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>  {# Include the EmailJS library #}
  <script type="text/javascript">
    (function(){
      emailjs.init({
        publicKey: "JtEjZpi5gTulnaLfS",  // Your EmailJS public key
      });
    })();

    function sendEmail(e) {
      e.preventDefault();  // Prevent default form submission

      const formData = new FormData(e.target);  // Get form data
      const templateParams = {
        to_email: formData.get('email'),  // Get the email address from the form
        username: formData.get('username')  // Get the username from the form
      };

      emailjs.send('service_ab2vrqc', 'template_oo7qvf5', templateParams)  // Send email with EmailJS
        .then((result) => {
          console.log(result.text);
          e.target.submit();  // Submit the form after successful email sending
        }, (error) => {
          console.log(error.text);
        });
    }
  </script>
{% endblock %}